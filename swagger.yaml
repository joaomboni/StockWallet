openapi: 3.0.0
info:
  title: API Busca Dados - Fundamentus
  version: "1.0.0"
  description: API que expõe endpoints para consultar dados financeiros (Yahoo Finance) e calcular o "Preço Justo".
servers:
  - url: http://localhost:{port}
    description: Servidor local
    variables:
      port:
        default: "3000"
        description: Porta onde o servidor está escutando (variável de ambiente `PROXY_PORT` no projeto)

paths:
  /api/hello-world:
    get:
      summary: Retorna uma saudação simples
      responses:
        '200':
          description: Mensagem de sucesso
          content:
            text/plain:
              schema:
                type: string
                example: "Hello World!"

  /api/api-busca:
    post:
      summary: Consulta fundamentos via Yahoo Finance
      description: Retorna indicadores básicos (P/L, LPA estimado, P/VPA, VPA, Dividend Yield e preço atual).
      parameters:
        - name: symbol
          in: query
          description: "Símbolo/ticker a ser consultado (ex: PETR4.SA, AAPL)"
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Dados retornados com fundamentos
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/YahooResponse'
        '400':
          description: Erro na consulta
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/preco-justo:
    post:
      summary: Calcula e persiste o Preço Justo
      description: Calcula o preço justo baseado em VPA e LPA, persiste no MongoDB e retorna o resultado.
      parameters:
        - name: symbol
          in: query
          description: "Símbolo/ticker a ser calculado (ex: PETR4.SA, AAPL)"
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Preço justo calculado e salvo
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PrecoJustoResponse'
        '400':
          description: Dados insuficientes ou erro no cálculo
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/delete:
    delete:
      summary: Exclui o registro de Preço Justo por símbolo
      description: Remove do MongoDB o documento associado ao símbolo informado.
      parameters:
        - name: symbol
          in: query
          description: "Símbolo/ticker a ser excluído (ex: PETR4.SA, AAPL)"
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Registro deletado com sucesso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'
        '400':
          description: Erro ao deletar (por exemplo, símbolo não encontrado)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  schemas:
    Fundamentals:
      type: object
      properties:
        pl:
          type: number
          nullable: true
        lpa:
          type: number
          nullable: true
        pvp:
          type: number
          nullable: true
        vpa:
          type: number
          nullable: true
        dividendYield:
          type: number
          nullable: true
        price:
          type: number
          nullable: true
      example:
        pl: 12.34
        lpa: 1.56
        pvp: 1.8
        vpa: 10.2
        dividendYield: 0.03
        price: 19.2

    YahooResponse:
      type: object
      properties:
        symbol:
          type: string
        pl:
          type: number
          nullable: true
        lpa:
          type: number
          nullable: true
        pvp:
          type: number
          nullable: true
        vpa:
          type: number
          nullable: true
        dividendYield:
          type: number
          nullable: true
        price:
          type: number
          nullable: true
      example:
        symbol: "PETR4.SA"
        pl: 12.34
        lpa: 1.56
        pvp: 1.8
        vpa: 10.2
        dividendYield: 0.03
        price: 19.2

    PrecoJustoResponse:
      type: object
      properties:
        symbol:
          type: string
        precoJusto:
          type: number
        fundamentos:
          $ref: '#/components/schemas/Fundamentals'
      example:
        symbol: "PETR4.SA"
        precoJusto: 14.8
        fundamentos:
          pl: 12.34
          lpa: 1.56
          pvp: 1.8
          vpa: 10.2
          dividendYield: 0.03
          price: 19.2

    MessageResponse:
      type: object
      properties:
        message:
          type: string
      example:
        message: "Registro com symbol PETR4.SA deletado com sucesso."

    ErrorResponse:
      type: object
      properties:
        error:
          type: string
      example:
        error: "Dados insuficientes para calcular o Preço Justo"

tags: []
